{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
  <link rel="stylesheet" href="{% static 'styles/style.css' %}" />

  <title>CollabSphere - Find study partners around the world!</title>
</head>

<body>
<div style="position:fixed;bottom:10px;left:10px;background:yellow;color:black;padding:8px;z-index:9999;">
  PROFILE TEMPLATE LOADED ✅
</div>

  <!-- Header Start -->
  <header class="header header--loggedIn">
    <div class="container">

      <a href="{% url 'home' %}" class="header__logo">
        <img src="{% static 'images/icons/logo.svg' %}" alt="CollabSphere" />
        <h1>CollabSphere</h1>
      </a>

      <form class="header__search" method="GET" action="{% url 'home' %}">
        <label>
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
            <title>search</title>
            <path
              d="M32 30.586l-10.845-10.845c1.771-2.092 2.845-4.791 2.845-7.741 0-6.617-5.383-12-12-12s-12 5.383-12 12c0 6.617 5.383 12 12 12 2.949 0 5.649-1.074 7.741-2.845l10.845 10.845 1.414-1.414zM12 22c-5.514 0-10-4.486-10-10s4.486-10 10-10c5.514 0 10 4.486 10 10s-4.486 10-10 10z">
            </path>
          </svg>
          <input name="q" placeholder="Search for posts" />
        </label>
      </form>

      <nav class="header__menu">

        {% if request.user.is_authenticated %}
        <div class="header__user">
          <a href="{% url 'user-profile' request.user.id %}">
            <div class="avatar avatar--medium active">
              <img src="{{ request.user.avatar.url }}" />
            </div>
            <p>{{ request.user.name }} <span>@{{ request.user.username }}</span></p>
          </a>

          <button class="dropdown-button" type="button">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
              <title>chevron-down</title>
              <path d="M16 21l-13-13h-3l16 16 16-16h-3l-13 13z"></path>
            </svg>
          </button>

          <div class="dropdown-menu">
            <a href="{% url 'update-user' %}" class="dropdown-link">
              Settings
            </a>
            <a href="{% url 'logout' %}" class="dropdown-link">
              Logout
            </a>
          </div>
        </div>

        {% else %}
        <a href="{% url 'login' %}">
          <img src="{% static 'images/avatar.svg' %}" />
          <p>Login</p>
        </a>
        {% endif %}

      </nav>

    </div>
  </header>
  <!-- Header End -->


  <main class="profile-page layout layout--3">
    <div class="container">

      <!-- Topics Start -->
      <div class="topics">
        <div class="topics__header">
          <h2>Browse Topics</h2>
        </div>

        <ul class="topics__list">
          <li>
            <a href="{% url 'home' %}" class="{% if not request.GET.q %}active{% endif %}">
              All <span>{{ topics.count }}</span>
            </a>
          </li>

          {% for topic in topics %}
          <li>
            <a href="{% url 'home' %}?q={{ topic.name }}">
              {{ topic.name }} <span>{{ topic.room_set.all.count }}</span>
            </a>
          </li>
          {% endfor %}
        </ul>

        <a class="btn btn--link" href="{% url 'topics' %}">
          More
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
            <title>chevron-down</title>
            <path d="M16 21l-13-13h-3l16 16 16-16h-3l-13 13z"></path>
          </svg>
        </a>
      </div>
      <!-- Topics End -->


      <!-- Room List Start -->
      <div class="roomList">

        <!-- Profile Card -->
        <div class="profile">
          <div class="profile__avatar">
            <div class="avatar avatar--large active">
              <img src="{{ user.avatar.url }}" />
            </div>
          </div>

          <div class="profile__info">
            <h3>{{ user.name }}</h3>
            <p>@{{ user.username }}</p>

            {% if request.user == user %}
            <a href="{% url 'update-user' %}" class="btn btn--main btn--pill">Edit Profile</a>
            {% endif %}
          </div>

          <div class="profile__about">
            <h3>About</h3>
            <p>{{ user.bio }}</p>
          </div>
        </div>

        <!-- FIXED TITLE (your request) -->
        <div class="roomList__header">
          <div>
            <h2>Study Rooms Hosted By @{{ user.username }}</h2>
          </div>
        </div>

        <!-- Rooms Loop -->
        {% for room in rooms %}
        <div class="roomListRoom">
          <div class="roomListRoom__header">
            <a href="{% url 'user-profile' room.host.id %}" class="roomListRoom__author">
              <div class="avatar avatar--small active">
                <img src="{{ room.host.avatar.url }}" />
              </div>
              <span>@{{ room.host.username }}</span>
            </a>

            <div class="roomListRoom__actions">
              <span>{{ room.created|timesince }} ago</span>
            </div>
          </div>

          <div class="roomListRoom__content">
            <a href="{% url 'room' room.id %}">{{ room.name }}</a>
            <p>{{ room.description|truncatechars:120 }}</p>
          </div>

          <div class="roomListRoom__meta">
            <a class="roomListRoom__joined">
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                <title>user-group</title>
                <path
                  d="M30.539 20.766c-2.69-1.547-5.75-2.427-8.92-2.662 0.649 0.291 1.303 0.575 1.918 0.928 0.715 0.412 1.288 1.005 1.71 1.694 1.507 0.419 2.956 1.003 4.298 1.774 0.281 0.162 0.456 0.487 0.456 0.85v4.65h-4v2h5c0.553 0 1-0.447 1-1v-5.65c0-1.077-0.56-2.067-1.461-2.584z">
                </path>
                <path
                  d="M22.539 20.766c-6.295-3.619-14.783-3.619-21.078 0-0.901 0.519-1.461 1.508-1.461 2.584v5.65c0 0.553 0.447 1 1 1h22c0.553 0 1-0.447 1-1v-5.651c0-1.075-0.56-2.064-1.461-2.583zM22 28h-20v-4.65c0-0.362 0.175-0.688 0.457-0.85 5.691-3.271 13.394-3.271 19.086 0 0.282 0.162 0.457 0.487 0.457 0.849v4.651z">
                </path>
                <path
                  d="M12 16c3.859 0 7-3.141 7-7s-3.141-7-7-7c-3.859 0-7 3.141-7 7s3.141 7 7 7zM12 4c2.757 0 5 2.243 5 5s-2.243 5-5 5-5-2.243-5-5c0-2.757 2.243-5 5-5z">
                </path>
              </svg>
              {{ room.participants.count }} Joined
            </a>
            <p class="roomListRoom__topic">{{ room.topic.name }}</p>
          </div>
        </div>
        {% empty %}
        <p style="padding: 1rem;">No rooms hosted yet.</p>
        {% endfor %}

      </div>
      <!-- Room List End -->


      <!-- Activities Start -->
      <div class="activities">
        <div class="activities__header">
          <h2>Recent Activities</h2>
        </div>

        {% for message in room_messages %}
        <div class="activities__box">
          <div class="activities__boxHeader roomListRoom__header">
            <a href="{% url 'user-profile' message.user.id %}" class="roomListRoom__author">
              <div class="avatar avatar--small active">
                <img src="{{ message.user.avatar.url }}" />
              </div>
              <p>
                @{{ message.user.username }}
                <span>{{ message.created|timesince }} ago</span>
              </p>
            </a>

            {% if request.user == message.user %}
            <div class="roomListRoom__actions">
              <a href="{% url 'delete-message' message.id %}">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                  <title>delete</title>
                  <path
                    d="M30 4h-8v-3c0-0.553-0.447-1-1-1h-10c-0.553 0-1 0.447-1 1v3h-8v2h2v24c0 1.104 0.897 2 2 2h20c1.103 0 2-0.896 2-2v-24h2v-2h-0zM12 2h8v2h-8v-2zM26.002 30l-0.002 1v-1h-20v-24h20v24h0.002z">
                  </path>
                </svg>
              </a>
            </div>
            {% endif %}
          </div>

          <div class="activities__boxContent">
            <p>
              replied to post “<a href="{% url 'room' message.room.id %}">{{ message.room }}</a>”
            </p>
            <div class="activities__boxRoomContent">
              {{ message.body|truncatechars:120 }}
            </div>
          </div>
        </div>
        {% empty %}
        <p style="padding: 1rem;">No recent activity.</p>
        {% endfor %}

      </div>
      <!-- Activities End -->

    </div>
  </main>

</body>
</html>
